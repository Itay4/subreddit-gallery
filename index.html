<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>SubReddit Photo Gallery</title>
		<script src="https://cdn.jsdelivr.net/npm/reddit.js@0.1.4/reddit.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		
		<style>

		input {
		  border: 3px solid grey;
		  text-indent: 5px;
		  padding: 5px;
		  margin: 1;
		  margin: 10px 10px;
		}
			
		.square {
		  float:left;
		  position: relative;
		  width: 30%;
		  padding-bottom : 30%; 
		  margin: 3px;
		  background-position:center center;
		  background-repeat:no-repeat;
		  background-size:cover;
		  border:4px solid grey;
		}
	
		</style>
	</head>

	<body>
		<div id="input-container">
			<input type="text" id="subreddit-input" placeholder="Type subreddit">
			<button id='app-btn'>ok</button>
		</div>	
		
		<div id="imgs-container"></div>
		
		<script>
			function getImagePosts(redditObject, n, callback) {
			  var imgPosts = []
			  function fetch() {
				redditObject.fetch(function(res) {
				  for(var post of res.data.children) {
					if(post.data.thumbnail === "") {
					  callback([])
					  return
					}
					if(post.data.thumbnail_width) {
					  imgPosts.push(post)
					  if(imgPosts.length == n) {
						callback(imgPosts)
						return
					  }
					}
				  }
				  redditObject.after(res.data.after)
				  fetch()
				})
			  }
			  fetch()
			}

			(function() {
			  var container = $("#imgs-container");
			  var input = $('#subreddit-input');
			  var btn = $('#app-btn');
			  btn.on('click', function() {
				container.empty();
				var sub = input.val();

				var redditObject = reddit.new(sub).limit(15);
				getImagePosts(redditObject, 9, function(imgs) {

				  for (var i = 0; i < imgs.length; i++) {
					var imgUrl = imgs[i].data.thumbnail;
					var imgTitle = imgs[i].data.title;
					var imgLink = "http://reddit.com"+imgs[i].data.permalink;

					var sqrId = 'img-sqr-' + i;

					container.append('<a class="square" target="_blank" href="'+imgLink+'" title="'+imgTitle+'"  id="'+sqrId+'"></div>');

					var sqr = container.find('#' + sqrId);

					sqr.css('background-image', 'url("' + imgUrl + '")');
				  }
				})
			  });
			})();
		</script>
	</body>
</html>